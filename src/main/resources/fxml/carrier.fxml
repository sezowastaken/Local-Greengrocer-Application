<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.shape.Circle?>

<StackPane xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" 
           fx:controller="com.group25.greengrocer.controller.CarrierController"
           prefWidth="960" prefHeight="540"
           styleClass="carrier-root"
           stylesheets="@../css/carrier.css">
    
    <!-- Main Carrier Panel -->
    <BorderPane>
        
        <!-- Collapsible Left Sidebar -->
        <left>
            <VBox fx:id="sidebarContainer" styleClass="carrier-sidebar" prefWidth="250" spacing="0">
                
                <!-- User Profile Section -->
                <VBox styleClass="carrier-sidebar-profile" spacing="12" alignment="CENTER">
                    <padding>
                        <Insets top="25" right="20" bottom="25" left="20"/>
                    </padding>
                    
                    <!-- Profile Picture Circle -->
                    <StackPane>
                        <Circle radius="40" styleClass="carrier-profile-circle"/>
                        <Label text="ðŸ‘¤" styleClass="carrier-profile-icon-large"/>
                    </StackPane>
                    
                    <VBox spacing="4" alignment="CENTER">
                        <Text fx:id="welcomeText" text="Carrier Name" styleClass="carrier-profile-name"/>
                        <Label text="ðŸšš Delivery Agent" styleClass="carrier-profile-role"/>
                        
                        <!-- Rating Display -->
                        <HBox spacing="5" alignment="CENTER" styleClass="carrier-rating-box">
                            <padding>
                                <Insets top="6" right="0" bottom="6" left="0"/>
                            </padding>
                            <Label text="â­" styleClass="carrier-rating-star"/>
                            <Label fx:id="ratingLabel" text="Rating: 0.0/5" styleClass="carrier-rating-text"/>
                        </HBox>
                        
                        <HBox spacing="8" alignment="CENTER" styleClass="carrier-profile-stats">
                            <padding>
                                <Insets top="8" right="0" bottom="0" left="0"/>
                            </padding>
                            <VBox spacing="2" alignment="CENTER" styleClass="carrier-stat-box">
                                <Label fx:id="activeCountLabel" text="0" styleClass="carrier-stat-value"/>
                                <Label text="Active" styleClass="carrier-stat-label"/>
                            </VBox>
                            <Separator orientation="VERTICAL" prefHeight="30"/>
                            <VBox spacing="2" alignment="CENTER" styleClass="carrier-stat-box">
                                <Label fx:id="completedCountLabel" text="0" styleClass="carrier-stat-value"/>
                                <Label text="Completed" styleClass="carrier-stat-label"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </VBox>
                
                <!-- Menu Items -->
                <ScrollPane fitToWidth="true" styleClass="carrier-sidebar-scroll" VBox.vgrow="ALWAYS">
                    <VBox spacing="5">
                        <padding>
                            <Insets top="15" right="15" bottom="20" left="15"/>
                        </padding>
                        
                        <Label text="NAVIGATION" styleClass="carrier-menu-header"/>
                        
                        <Button text="ðŸ”„ Refresh All" onAction="#handleRefreshAll" styleClass="carrier-menu-btn" maxWidth="Infinity"/>
                        
                        <Separator styleClass="carrier-menu-separator"/>
                        
                        <Label text="ACCOUNT" styleClass="carrier-menu-header"/>
                        
                        <Button text="ðŸ‘¤ My Profile" onAction="#handleShowProfile" styleClass="carrier-menu-btn" maxWidth="Infinity"/>
                        
                        <Separator styleClass="carrier-menu-separator"/>
                        
                        <Button text="ðŸšª Logout" onAction="#handleLogout" styleClass="carrier-menu-btn-logout" maxWidth="Infinity"/>
                    </VBox>
                </ScrollPane>
                
            </VBox>
        </left>
        
        <!-- Main Content Area -->
        <center>
            <BorderPane stylesheets="@../css/app.css">
                
                <!-- Top Header with Toggle Button -->
                <top>
                    <HBox alignment="CENTER_LEFT" styleClass="carrier-top-header" spacing="15">
                        <padding>
                            <Insets top="15" right="25" bottom="15" left="25"/>
                        </padding>
                        
                        <!-- Sidebar Toggle Button -->
                        <Button fx:id="sidebarToggleBtn" text="â˜°" styleClass="carrier-sidebar-toggle" onAction="#handleToggleSidebar"/>
                        
                        <Text text="ðŸ“¦ Delivery Management Dashboard" styleClass="carrier-header-title"/>
                    </HBox>
                </top>
                
                <!-- Main Content with ScrollPane -->
                <center>
                    <ScrollPane fitToWidth="true" styleClass="carrier-scroll-pane" vbarPolicy="AS_NEEDED" hbarPolicy="NEVER">
                        <VBox spacing="20">
                            <padding>
                                <Insets top="25" right="25" bottom="25" left="25"/>
                            </padding>
                            
                            <!-- Available Orders Section -->
                            <VBox spacing="12" styleClass="carrier-section-card">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                <HBox alignment="CENTER_LEFT" spacing="15">
                                    <Label text="ðŸ†•" styleClass="carrier-section-icon"/>
                                    <VBox spacing="2">
                                        <Text text="Available Orders" styleClass="carrier-section-title-blue"/>
                                        <Text text="Orders ready to be picked up" styleClass="carrier-section-subtitle"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="ðŸ”„ Refresh" onAction="#handleRefreshAvailable" styleClass="carrier-btn-section-blue"/>
                                </HBox>
                                
                                <TableView fx:id="availableOrdersTable" styleClass="carrier-table" prefHeight="180">
                                    <columns>
                                        <TableColumn fx:id="availOrderIdCol" text="ðŸ“‹ ID" prefWidth="70"/>
                                        <TableColumn fx:id="availCustomerNameCol" text="ðŸ‘¤ Customer" prefWidth="140"/>
                                        <TableColumn fx:id="availCustomerAddressCol" text="ðŸ“ Address" prefWidth="200"/>
                                        <TableColumn fx:id="availDeliveryDateCol" text="ðŸ“… Delivery" prefWidth="130"/>
                                        <TableColumn fx:id="availTotalCol" text="ðŸ’° Total" prefWidth="90"/>
                                        <TableColumn fx:id="availActionsCol" text="âš¡ Actions" prefWidth="160"/>
                                    </columns>
                                    <placeholder>
                                        <VBox alignment="CENTER" spacing="10" styleClass="carrier-empty-placeholder">
                                            <Text text="ðŸ“­" styleClass="carrier-empty-icon"/>
                                            <Label text="No available orders at the moment" styleClass="carrier-empty-text"/>
                                        </VBox>
                                    </placeholder>
                                </TableView>
                            </VBox>
                            
                            <!-- Current Orders Section -->
                            <VBox spacing="12" styleClass="carrier-section-card">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                <HBox alignment="CENTER_LEFT" spacing="15">
                                    <Label text="ðŸšš" styleClass="carrier-section-icon"/>
                                    <VBox spacing="2">
                                        <Text text="Current Orders" styleClass="carrier-section-title-orange"/>
                                        <Text text="Orders assigned to you for delivery" styleClass="carrier-section-subtitle"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="ðŸ”„ Refresh" onAction="#handleRefreshCurrent" styleClass="carrier-btn-section-orange"/>
                                </HBox>
                                
                                <TableView fx:id="currentOrdersTable" styleClass="carrier-table" prefHeight="180">
                                    <columns>
                                        <TableColumn fx:id="currOrderIdCol" text="ðŸ“‹ ID" prefWidth="70"/>
                                        <TableColumn fx:id="currCustomerNameCol" text="ðŸ‘¤ Customer" prefWidth="140"/>
                                        <TableColumn fx:id="currCustomerAddressCol" text="ðŸ“ Address" prefWidth="200"/>
                                        <TableColumn fx:id="currDeliveryDateCol" text="ðŸ“… Delivery" prefWidth="130"/>
                                        <TableColumn fx:id="currTotalCol" text="ðŸ’° Total" prefWidth="90"/>
                                        <TableColumn fx:id="currActionsCol" text="âš¡ Actions" prefWidth="160"/>
                                    </columns>
                                    <placeholder>
                                        <VBox alignment="CENTER" spacing="10" styleClass="carrier-empty-placeholder">
                                            <Text text="ðŸ“¦" styleClass="carrier-empty-icon"/>
                                            <Label text="No orders in progress" styleClass="carrier-empty-text"/>
                                        </VBox>
                                    </placeholder>
                                </TableView>
                            </VBox>
                            
                            <!-- Completed Orders Section -->
                            <VBox spacing="12" styleClass="carrier-section-card">
                                <padding>
                                    <Insets top="20" right="20" bottom="20" left="20"/>
                                </padding>
                                <HBox alignment="CENTER_LEFT" spacing="15">
                                    <Label text="âœ…" styleClass="carrier-section-icon"/>
                                    <VBox spacing="2">
                                        <Text text="Completed Orders" styleClass="carrier-section-title-green"/>
                                        <Text text="Successfully delivered orders" styleClass="carrier-section-subtitle"/>
                                    </VBox>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Button text="ðŸ”„ Refresh" onAction="#handleRefreshCompleted" styleClass="carrier-btn-section-green"/>
                                </HBox>
                                
                                <TableView fx:id="completedOrdersTable" styleClass="carrier-table" prefHeight="180">
                                    <columns>
                                        <TableColumn fx:id="compOrderIdCol" text="ðŸ“‹ ID" prefWidth="60"/>
                                        <TableColumn fx:id="compCustomerNameCol" text="ðŸ‘¤ Customer" prefWidth="120"/>
                                        <TableColumn fx:id="compRequestedDateCol" text="ðŸ“… Requested" prefWidth="120"/>
                                        <TableColumn fx:id="compDeliveredDateCol" text="âœ… Delivered" prefWidth="120"/>
                                        <TableColumn fx:id="compRatingCol" text="â­ Rating" prefWidth="80"/>
                                        <TableColumn fx:id="compTotalCol" text="ðŸ’° Total" prefWidth="80"/>
                                        <TableColumn fx:id="compActionsCol" text="âš¡ Actions" prefWidth="130"/>
                                    </columns>
                                    <placeholder>
                                        <VBox alignment="CENTER" spacing="10" styleClass="carrier-empty-placeholder">
                                            <Text text="ðŸ“‹" styleClass="carrier-empty-icon"/>
                                            <Label text="No completed deliveries yet" styleClass="carrier-empty-text"/>
                                        </VBox>
                                    </placeholder>
                                </TableView>
                            </VBox>
                            
                        </VBox>
                    </ScrollPane>
                </center>
                
            </BorderPane>
        </center>
        
    </BorderPane>

    <!-- Order Details Popup -->
    <VBox fx:id="orderDetailsPopup" visible="false" managed="false" 
          spacing="20" styleClass="carrier-popup"
          maxWidth="650" maxHeight="550" alignment="CENTER">
        <padding>
            <Insets top="30" right="30" bottom="30" left="30"/>
        </padding>
        
        <!-- Popup Header -->
        <HBox alignment="CENTER_LEFT" spacing="15" styleClass="carrier-popup-header">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>
            <Label text="ðŸ“¦" styleClass="carrier-popup-icon"/>
            <Label fx:id="orderDetailsTitleLabel" text="Order Details" styleClass="carrier-popup-title"/>
        </HBox>
        
        <TableView fx:id="orderDetailsTable" VBox.vgrow="ALWAYS" styleClass="carrier-popup-table">
            <columns>
                <TableColumn fx:id="detailProductNameCol" text="ðŸ›’ Product" prefWidth="220"/>
                <TableColumn fx:id="detailQuantityCol" text="ðŸ“Š Qty" prefWidth="80"/>
                <TableColumn fx:id="detailUnitCol" text="ðŸ“ Unit" prefWidth="80"/>
                <TableColumn fx:id="detailUnitPriceCol" text="ðŸ’µ Price" prefWidth="90"/>
                <TableColumn fx:id="detailLineTotalCol" text="ðŸ’° Total" prefWidth="100"/>
            </columns>
            <placeholder>
                <Label text="No products in this order."/>
            </placeholder>
        </TableView>

        <!-- Total Section -->
        <HBox spacing="20" alignment="CENTER_RIGHT" styleClass="carrier-popup-total">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>
            <Label text="ðŸ’° Total Amount:" styleClass="carrier-popup-total-label"/>
            <Label fx:id="orderDetailsTotalLabel" text="\$0.00" styleClass="carrier-popup-total-value"/>
        </HBox>

        <!-- Close Button -->
        <Button text="âœ– Close" onAction="#handleCloseOrderDetails" styleClass="carrier-popup-close-btn"/>
    </VBox>
    
</StackPane>
