<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns:fx="http://javafx.com/fxml" fx:controller="com.group25.greengrocer.controller.CustomerController"
            stylesheets="@../css/customer.css" prefWidth="960" prefHeight="540">
    <top>
        <HBox spacing="20" alignment="CENTER_LEFT" style="-fx-padding: 15; -fx-background-color: white; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 0, 0, 5, 0);">
            <Text fx:id="welcomeText" text="Welcome, Customer" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-fill: #2e7d32;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <HBox spacing="12" alignment="CENTER_RIGHT">
                <Button fx:id="shopButton" text="Shop" onAction="#handleBackToShop" styleClass="button-outline" prefWidth="120"/>
                <Button fx:id="cartButton" text="My Cart" onAction="#handleViewCart" styleClass="button-primary" prefWidth="120"/>
                <MenuButton fx:id="menuButton" text="Menu" styleClass="menu-button-custom" prefWidth="120">
                    <items>
                        <MenuItem text="My Profile" onAction="#handleViewProfile" styleClass="profile-btn"/>
                        <MenuItem text="Order History" onAction="#handleViewOrders" styleClass="button-secondary"/>
                        <MenuItem text="Logout" onAction="#handleLogout" style="-fx-background-color: transparent; -fx-text-fill: #666; -fx-cursor: hand;"/>
                        <MenuItem text="Messages" onAction="#handleViewMessages" styleClass="button-secondary"/>
                    </items>
                </MenuButton>
            </HBox>
        </HBox>
    </top>
    
    <center>
        <VBox spacing="0" style="-fx-background-color: transparent;">
            <!-- Selector Bar -->
            <!-- Selector Bar (Smaller & compact) -->
            <HBox fx:id="selectorBar" alignment="CENTER" spacing="10" style="-fx-padding: 10 0 10 0;">
                <ToggleButton fx:id="vegetablesToggle" styleClass="selector-toggle" prefWidth="110" prefHeight="40">
                    <toggleGroup>
                        <ToggleGroup fx:id="categoryToggleGroup"/>
                    </toggleGroup>
                </ToggleButton>
                <ToggleButton fx:id="fruitsToggle" toggleGroup="$categoryToggleGroup" styleClass="selector-toggle" prefWidth="110" prefHeight="40"/>
            </HBox>

            <!-- Responsive Modern Separator (maxWidth limited but responsive using Layout constraints) -->
            <VBox alignment="CENTER" style="-fx-padding: 0 0 10 0;">
                <Region styleClass="modern-separator-line" maxWidth="800" prefWidth="2000" prefHeight="1"/>
            </VBox>

            <!-- Content Area -->
            <StackPane VBox.vgrow="ALWAYS">
                <!-- Vegetables View -->
                <ScrollPane fx:id="vegetableView" fitToWidth="true" style="-fx-background-color: transparent; -fx-padding: 15 20 20 20;">
                    <FlowPane fx:id="vegPane" alignment="CENTER" hgap="20" vgap="25" style="-fx-background-color: transparent; -fx-padding: 10 0 0 0;"/>
                </ScrollPane>

                <!-- Fruits View -->
                <ScrollPane fx:id="fruitView" fitToWidth="true" visible="false" managed="false" style="-fx-background-color: transparent; -fx-padding: 15 20 20 20;">
                    <FlowPane fx:id="fruitPane" alignment="CENTER" hgap="20" vgap="25" style="-fx-background-color: transparent; -fx-padding: 10 0 0 0;"/>
                </ScrollPane>

            <!-- Cart View (Initially Hidden) -->
            <!-- Cart View -->
            <VBox fx:id="cartView" visible="false" style="-fx-background-color: white; -fx-padding: 30;" alignment="TOP_CENTER">
                <Text text="My Shopping Cart" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #2e7d32;"/>
                
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" style="-fx-background-color: transparent; -fx-background: white; -fx-padding: 10;">
                     <VBox spacing="20">
                         <!-- Items List -->
                         <VBox fx:id="cartItemsContainer" spacing="10"/>

                         <!-- Bottom Summary Section (Inside ScrollPane) -->
                         <VBox spacing="20" style="-fx-padding: 20 0 0 0; -fx-border-color: #eee; -fx-border-width: 1 0 0 0;">
                            <HBox spacing="20" alignment="CENTER_RIGHT">
                                <Label text="Total:" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                <Label fx:id="cartTotalLabel" text="\$0.00" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                            </HBox>

                            <HBox spacing="20" alignment="CENTER">
                                <Button text="Back to Shopping" onAction="#handleBackToShop" styleClass="button-secondary"/>
                                <Button text="Checkout" onAction="#handleProceedToPayment" styleClass="button-primary" style="-fx-font-size: 16px; -fx-padding: 10 30;"/>
                            </HBox>
                        </VBox>
                     </VBox>
                </ScrollPane>
            </VBox>
            
            <!-- Payment View (Initially Hidden) -->
            <!-- Payment View (Initially Hidden) -->
            <BorderPane fx:id="paymentView" visible="false" style="-fx-background-color: white; -fx-padding: 30;" maxWidth="1000">
                <top>
                    <VBox alignment="TOP_CENTER" style="-fx-padding: 0 0 20 0;">
                        <Text text="Secure Checkout" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #2e7d32;"/>
                    </VBox>
                </top>
                
                <center>
                    <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: white;">
                        <HBox spacing="40" alignment="TOP_CENTER" style="-fx-padding: 20;">
                            
                            <!-- LEFT COLUMN: Products & Note -->
                            <VBox spacing="20" HBox.hgrow="ALWAYS" maxWidth="600">
                                <!-- Product List Section -->
                                <VBox spacing="10" VBox.vgrow="ALWAYS">
                                    <Label text="Your Items" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #333;"/>
                                    <VBox fx:id="paymentItemsContainer" spacing="10" style="-fx-background-color: #f9f9f9; -fx-padding: 20; -fx-background-radius: 8; -fx-border-color: #eee; -fx-border-radius: 8;" VBox.vgrow="ALWAYS"/>
                                </VBox>
                                
                                <!-- Note Section -->
                                <VBox spacing="10">
                                    <Label text="Note for Courier (Optional)" style="-fx-font-weight: bold;"/>
                                    <TextArea fx:id="paymentNoteArea" promptText="E.g. Please ring the bell, leave at door..." prefHeight="120" wrapText="true" style="-fx-border-color: #ddd; -fx-background-radius: 5;"/>
                                </VBox>
                            </VBox>
                            
                            <!-- RIGHT COLUMN: Financials, Coupon, Payment Method -->
                            <VBox spacing="20" maxWidth="400" minWidth="350" HBox.hgrow="NEVER">
                                <!-- Financial Summary -->
                                <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #eee; -fx-border-radius: 8; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.05), 5, 0, 0, 2);">
                                    <Label text="Order Summary" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                    
                                    <VBox spacing="8">
                                        <HBox alignment="CENTER_LEFT" spacing="10">
                                            <Label text="Subtotal:" style="-fx-font-weight: bold;"/>
                                            <Region HBox.hgrow="ALWAYS" />
                                            <Label fx:id="paymentSubtotalLabel" text="\$0.00"/>
                                        </HBox>
                                        <HBox alignment="CENTER_LEFT" spacing="10">
                                            <Label text="Loyalty Discount:" style="-fx-text-fill: #2e7d32;"/>
                                            <Region HBox.hgrow="ALWAYS" />
                                            <Label fx:id="paymentLoyaltyLabel" text="-\$0.00" style="-fx-text-fill: #2e7d32;"/>
                                        </HBox>
                                         <HBox alignment="CENTER_LEFT" spacing="10">
                                            <Label text="Coupon Discount:" style="-fx-text-fill: #e67e22;"/>
                                            <Region HBox.hgrow="ALWAYS" />
                                            <Label fx:id="paymentCouponLabel" text="-\$0.00" style="-fx-text-fill: #e67e22;"/>
                                        </HBox>
                                    </VBox>
                    
                                    <Separator/>
                                    
                                    <HBox spacing="10" alignment="CENTER_RIGHT">
                                        <Label text="Total to Pay:" style="-fx-font-size: 16px;"/>
                                        <Label fx:id="paymentTotalLabel" text="\$0.00" style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                                    </HBox>
                                </VBox>
                                
                                <!-- Coupon Section -->
                                <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #eee; -fx-border-radius: 8; -fx-background-radius: 8;">
                                     <Label text="Have a Coupon?" style="-fx-font-weight: bold;"/>
                                     <HBox spacing="10">
                                         <TextField fx:id="couponCodeField" promptText="Code" HBox.hgrow="ALWAYS"/>
                                         <Button text="Apply" onAction="#handleApplyCoupon" styleClass="button-outline"/>
                                     </HBox>
                                     <Label fx:id="couponMessageLabel" text="" style="-fx-font-size: 12px;"/>
                                </VBox>
                                
                                <!-- Payment Method -->
                                <VBox spacing="15" style="-fx-background-color: #f9f9f9; -fx-padding: 20; -fx-background-radius: 10; -fx-border-color: #eee;">
                                    <Label text="Payment Method" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                    
                                    <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: white; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #ddd;">
                                        <Label text="ðŸ’µ" style="-fx-font-size: 24px;"/>
                                        <VBox>
                                            <Label text="Cash on Delivery" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                            <Label text="Pay on receipt" style="-fx-text-fill: #666; -fx-font-size: 12px;"/>
                                        </VBox>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Label text="SELECTED" style="-fx-background-color: #e8f5e9; -fx-text-fill: #2e7d32; -fx-padding: 3 8; -fx-background-radius: 10; -fx-font-size: 10px; -fx-font-weight: bold;"/>
                                    </HBox>
                
                                    <!-- Credit Card (Coming Soon) -->
                                    <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: #f0f0f0; -fx-padding: 15; -fx-background-radius: 5; -fx-border-color: #ddd; -fx-opacity: 0.7;">
                                        <Label text="ðŸ’³" style="-fx-font-size: 24px; -fx-opacity: 0.5;"/>
                                        <VBox>
                                            <Label text="Credit Card" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #888;"/>
                                            <Label text="Secure Payment" style="-fx-text-fill: #999; -fx-font-size: 12px;"/>
                                        </VBox>
                                        <Region HBox.hgrow="ALWAYS"/>
                                        <Label text="COMING SOON" style="-fx-background-color: #eee; -fx-text-fill: #666; -fx-padding: 3 8; -fx-background-radius: 10; -fx-font-size: 10px; -fx-font-weight: bold;"/>
                                    </HBox>
                                </VBox>
                            </VBox>
                        </HBox>
                    </ScrollPane>
                </center>

                <bottom>
                    <VBox spacing="20" style="-fx-padding: 20 0 0 0;">
                        <HBox spacing="20" alignment="CENTER" style="-fx-padding: 20 0 0 0; -fx-border-color: #eee; -fx-border-width: 1 0 0 0;">
                            <Button text="Back to Cart" onAction="#handleViewCart" styleClass="button-secondary"/>
                            <Button text="Confirm &amp; Pay" onAction="#handleConfirmPayment" styleClass="button-primary" style="-fx-font-size: 16px; -fx-padding: 10 30;"/>
                        </HBox>
                    </VBox>
                </bottom>
            </BorderPane>
            
            <!-- Profile View (Initially Hidden) -->
            <ScrollPane fx:id="profileView" visible="false" fitToWidth="true" style="-fx-background-color: white; -fx-padding: 20;" maxWidth="700">
                 <VBox spacing="20" alignment="TOP_CENTER">
                     <Text text="My Profile" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #2e7d32;"/>
                     
                     <GridPane vgap="10" hgap="15" alignment="CENTER_LEFT" style="-fx-max-width: 500;">
                        <columnConstraints>
                            <ColumnConstraints minWidth="120" prefWidth="120" halignment="RIGHT"/>
                            <ColumnConstraints hgrow="ALWAYS" />
                        </columnConstraints>

                        <!-- Username -->
                        <Label text="Username:" GridPane.rowIndex="0" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                        <VBox GridPane.rowIndex="0" GridPane.columnIndex="1" spacing="2">
                            <TextField fx:id="profileNameField" editable="true" prefWidth="300"/>
                            <Label fx:id="usernameErrorLabel" text="" styleClass="error-label" visible="false" managed="false" style="-fx-font-size: 11px;"/>
                        </VBox>

                        <!-- Address -->
                        <Label text="Address Line:" GridPane.rowIndex="1" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                        <VBox GridPane.rowIndex="1" GridPane.columnIndex="1" spacing="2">
                            <TextArea fx:id="profileAddressField" prefWidth="300" prefHeight="60" wrapText="true"/>
                            <Label fx:id="addressErrorLabel" text="" styleClass="error-label" visible="false" managed="false" style="-fx-font-size: 11px;"/>
                        </VBox>

                        <!-- City -->
                        <Label text="City:" GridPane.rowIndex="2" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                        <VBox GridPane.rowIndex="2" GridPane.columnIndex="1" spacing="2">
                            <ComboBox fx:id="profileCityCombo" prefWidth="300" editable="true"/>
                            <Label fx:id="cityErrorLabel" text="" styleClass="error-label" visible="false" managed="false" style="-fx-font-size: 11px;"/>
                        </VBox>

                        <!-- Phone -->
                        <Label text="Phone:" GridPane.rowIndex="3" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                        <VBox GridPane.rowIndex="3" GridPane.columnIndex="1" spacing="2">
                            <TextField fx:id="profilePhoneField" prefWidth="300" promptText="5321234567"/>
                            <Label fx:id="phoneErrorLabel" text="" styleClass="error-label" visible="false" managed="false" style="-fx-font-size: 11px;"/>
                        </VBox>
                     </GridPane>

                     <HBox spacing="20" alignment="CENTER" style="-fx-padding: 10 0 20 0;">
                        <Button text="Back" onAction="#handleBackToShop" styleClass="button-secondary"/>
                        <Button fx:id="saveProfileButton" text="Save Changes" onAction="#handleSaveProfile" styleClass="button-primary"/>
                     </HBox>

                     <Separator orientation="HORIZONTAL"/>

                     <!-- Change Password Section -->
                     <VBox spacing="10" alignment="TOP_CENTER" style="-fx-max-width: 500; -fx-padding: 10; -fx-background-color: #fafafa; -fx-background-radius: 5; -fx-border-color: #eee; -fx-border-radius: 5;">
                        <Label text="Change Password" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #555;"/>
                        
                        <GridPane vgap="10" hgap="15" alignment="CENTER_LEFT">
                             <columnConstraints>
                                <ColumnConstraints minWidth="130" prefWidth="130" halignment="RIGHT"/>
                                <ColumnConstraints hgrow="ALWAYS" />
                            </columnConstraints>

                            <Label text="Current Password:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <PasswordField fx:id="currentPasswordField" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                            <Label text="New Password:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <PasswordField fx:id="newPasswordField" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                            <Label text="Confirm Password:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <VBox GridPane.rowIndex="2" GridPane.columnIndex="1" spacing="2">
                                <PasswordField fx:id="confirmPasswordField"/>
                                <Label fx:id="passwordErrorLabel" text="" styleClass="error-label" visible="false" managed="false" style="-fx-font-size: 11px;"/>
                            </VBox>
                        </GridPane>

                        <HBox alignment="CENTER_RIGHT" spacing="10" style="-fx-padding: 10 0 0 0;">
                             <Button text="Update Password" onAction="#handleChangePassword" styleClass="button-outline"/>
                        </HBox>
                     </VBox>
                 </VBox>
            </ScrollPane>

           <!-- Orders View (Initially Hidden) -->
            <VBox fx:id="ordersView" visible="false" spacing="20" style="-fx-background-color: white; -fx-padding: 30;">
                <HBox alignment="CENTER_LEFT">
                     <Text text="My Order History" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #2e7d32;"/>
                     <Region HBox.hgrow="ALWAYS"/>
                     <Button text="Refresh" onAction="#handleRefreshOrders" styleClass="button-secondary"/>
                     <Button text="Back to Shop" onAction="#handleBackToShop" styleClass="button-secondary" style="-fx-margin-left: 10;"/>
                </HBox>
                <TableView fx:id="ordersTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="colOrderId" text="Order ID" prefWidth="80"/>
                        <TableColumn fx:id="colOrderDate" text="Date" prefWidth="150"/>
                        <TableColumn fx:id="colOrderTotal" text="Total" prefWidth="100"/>
                        <TableColumn fx:id="colOrderStatus" text="Status" prefWidth="100"/>
                        <TableColumn fx:id="colOrderAction" text="Action" prefWidth="150"/>
                    </columns>
                    <columnResizePolicy>
                        <TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/>
                    </columnResizePolicy>
                </TableView>
            </VBox>

            <!-- Messages View (Initially Hidden) -->
            <VBox fx:id="messagesView" visible="false" spacing="20" style="-fx-background-color: white; -fx-padding: 30;">
                 <HBox alignment="CENTER_LEFT">
                     <Text text="Message Center" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-fill: #2e7d32;"/>
                     <Region HBox.hgrow="ALWAYS"/>
                     <Button text="Refresh" onAction="#handleRefreshMessages" styleClass="button-secondary"/>
                     <Button text="Back to Shop" onAction="#handleBackToShop" styleClass="button-secondary" style="-fx-margin-left: 10;"/>
                </HBox>
                
                <ListView fx:id="messagesListView" VBox.vgrow="ALWAYS" styleClass="chat-list-view"/>
                
                <VBox spacing="10">
                    <Label text="New Message"/>
                    <TextField fx:id="txtMsgSubject" promptText="Subject" styleClass="text-field, green-input-field"/>
                    <TextArea fx:id="txtMsgContent" promptText="Message content..." prefHeight="100" styleClass="text-area, green-input-field"/>
                    <Button text="Send Message" onAction="#handleSendMessage" styleClass="button-primary"/>
                </VBox>
            </VBox>
            
            </StackPane>
        </VBox>
    </center>
</BorderPane>
